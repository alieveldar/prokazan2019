function ItemInfo(name,last,vlog) { caption="Задание &laquo;"+name+"&raquo;"; text="Последний запуск: <b>"+last+"</b><div class='C10'></div><b>Результат выполнения:</b><div class='ScrollText2'>"+vlog+"</div>"; ViewBlank(caption,text); } function AddNewTask(nid, pid) { var cap="Добавить задание"; var button='<div class="CenterText" id="JSLoader"><input type="submit" class="SaveButton" value="Добавить" onclick="AddNewTaskAct(\''+nid+'\', \''+pid+'\');"></div>'; text='<tr class="TRLine0"><td>Название задания<star>*</star></td><td class="NormalInput"><input id="Rn0" type="text" class="JsVerify"></td></tr>'; text=text+'<tr class="TRLine1"><td>Путь к файлу<star>*</star></td><td class="NormalInput"><input id="Rl0" type="text" class="JsVerify" placeholder="/cron/cron.php"></td></tr>'; text=text+'<tr class="TRLine1"><td>Период запуска<star>*</star></td><td class="NormalInput"><div class="sdiv"><select id="Rs0"><option value="300">Каждые 5 минут</option><option value="600">Каждые 10 минут</option><option value="900">Каждые 15 минут</option><option value="1800">Каждые 30 минут</option><option value="3600">Каждый 1 час</option><option value="10800">Каждые 3 часа</option><option value="21600">Каждые 6 часов</option><option value="43200">Каждый день</option><option value="302400">Каждую неделю</option><option value="0030">Каждый день в 00:30</option></select></div></td></tr>'; text="<div class='RoundText' id='Tgg' style='width:500px;'><table>"+text+"</table><div class='C10'></div>"+button+"</div>"; ViewBlank(cap, text); } function AddNewTaskAct() { name=$('#Rn0').val(); link=$('#Rl0').val(); time=$('#Rs0').val(); error=0; if (name=="" || name=="NULL"){ error=1; $("#Rn0").toggleClass("ErrorInput", true);} if (link=="" || link=="NULL"){ error=1; $("#Rl0").toggleClass("ErrorInput", true);} if (error==0) { $("#JSLoader").html(loader2); JsHttpRequest.query('modules/adm/cron-add-JSReq.php',{'name':name, 'link':link, 'time':time}, function(result,errors){if(result){ /*s*/ ActionAndUpdate(0,0); /*e*/ }},true); }} function ItemEdit(id, name, link, time) { var cap="Редактировать задание"; text=""; p=new Array();  switch(time) { case "300": { p[1]="selected"; break; } case "600": { p[2]="selected"; break; } case "900": { p[3]="selected"; break; } case "1800": { p[4]="selected"; break; } case "3600": { p[5]="selected"; break; }  case "10800": { p[6]="selected"; break; } case "21600": { p[7]="selected"; break; } case "43200": { p[8]="selected"; break; } case "302400": { p[9]="selected"; break; } case "0030": { p[10]="selected"; break; }} opts='<option value="300" '+p[1]+'>Каждые 5 минут</option><option value="600" '+p[2]+'>Каждые 10 минут</option><option value="900" '+p[3]+'>Каждые 15 минут</option><option value="1800" '+p[4]+'>Каждые 30 минут</option><option value="3600" '+p[5]+'>Каждый 1 час</option><option value="10800" '+p[6]+'>Каждые 3 часа</option><option value="21600" '+p[7]+'>Каждые 6 часов</option><option value="43200" '+p[8]+'>Каждый день</option><option value="302400" '+p[9]+'>Каждую неделю</option><option value="0030" '+p[10]+'>Каждый день в 00:30</option>'; var button='<div class="CenterText" id="JSLoader"><input type="submit" class="SaveButton" value="Сохранить" onclick="SaveTaskItem(\''+id+'\');"></div>'; text=text+"<tr class='TRLine0'><td>Название задания<star>*</star></td><td class='NormalInput'><input id='Rned' type='text' class='JsVerify' value='"+name+"'></td></tr>"; text=text+"<tr class='TRLine1'><td>Путь к файлу<star>*</star></td><td class='NormalInput'><input id='Rled' type='text' class='JsVerify' value='"+link+"'></td></tr>"; text=text+'<tr class="TRLine1"><td>Период запуска<star>*</star></td><td class="NormalInput"><div class="sdiv"><select id="Rles">'+opts+'</select></div></td></tr>'; text="<div class='RoundText' id='Tgg' style='width:500px;'><table>"+text+"</table><div class='C10'></div>"+button+"</div>"; ViewBlank(cap, text); } function SaveTaskItem(id) { name=$('#Rned').val(); link=$('#Rled').val(); time=$('#Rles').val(); error=0; if (name=="" || name=="NULL"){ error=1; $("#Rned").toggleClass("ErrorInput", true);} if (link=="" || link=="NULL"){ error=1; $("#Rled").toggleClass("ErrorInput", true);} $("#JSLoader").html(loader2); JsHttpRequest.query('modules/adm/cron-edit-JSReq.php',{'id':id, 'name':name, 'link':link, 'time':time}, function(result,errors){if(result){ /*s*/ ActionAndUpdate(0,0); /*e*/ }},true); } function ItemDelete(id) { caption="Подтвердите удаление"; text='Удалить задачу по расписанию?<br>Данное действие будет невозможно отменить.'+"<div class='C25'></div><div class='LinkG' style='float:left; margin-right:5px;'><a href='javascript:void(0);' onclick='ActionAndUpdate("+id+", \"DEL\");'>Удалить</a></div><div class='LinkR'><a href='javascript:void(0);' onclick='CloseBlank();'>Отмена</a></div><div class='C10'></div>"; ViewBlank(caption, text); } function ItemUp(id) { ActionAndUpdate(id, 'UP'); } function ItemDown(id) { ActionAndUpdate(id, 'DOWN'); } function ActionAndUpdate(id, act) { CloseBlank(); $("#Msg2").html("Идет сохранение данных..."); $("#Msg2").removeClass(); $("#Msg2").addClass("SaveDiv"); JsHttpRequest.query('modules/adm/cron-update-JSReq.php',{'id':id, 'act':act},function(result,errors){ if(result){  /*s*/ $("#Tgg").html(result["content"]); $("#Msg2").html("Данные успешно сохранены"); $("#Msg2").removeClass(); $("#Msg2").addClass("SuccessDiv"); $('#Tgg input').tzCheckbox({labels:['да ','нет']}); /*e*/ }},true); }